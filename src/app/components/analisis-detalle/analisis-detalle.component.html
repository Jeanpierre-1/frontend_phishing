<div class="analisis-detalle-container">
  <div class="analisis-detalle-content">

    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h1>ğŸ“Š Reporte Detallado del AnÃ¡lisis</h1>
        <p>CaracterÃ­sticas completas del anÃ¡lisis de phishing</p>
      </div>
      <div class="header-actions">
        <button class="btn-action btn-volver" (click)="volverAlInicio()">
          â† Volver al Inicio
        </button>
        <button class="btn-action btn-historial" (click)="verHistorial()">
          ğŸ“‹ Ver Historial
        </button>
        <button class="btn-action btn-exportar-pdf" (click)="exportarPDF()">
          ğŸ“¥ Exportar PDF
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="cargando">
      <div class="spinner"></div>
      <p>Cargando anÃ¡lisis...</p>
    </div>

    <!-- Contenido del AnÃ¡lisis -->
    <div class="analisis-content" *ngIf="!cargando && analisis">

      <!-- AnÃ¡lisis Detallado -->
      <div class="analisis-card">
        <div class="card-header">
          <h2>ğŸ” Resultado del AnÃ¡lisis</h2>
          <span class="badge-resultado" [ngClass]="analisis.isPhishing ? 'badge-peligro' : 'badge-seguro'">
            {{ analisis.isPhishing ? 'âš ï¸ PHISHING DETECTADO' : 'âœ… SITIO SEGURO' }}
          </span>
        </div>

        <div class="detalle-grid">
          <!-- URL -->
          <div class="detalle-item full-width">
            <span class="detalle-label">ğŸ”— URL Analizada</span>
            <span class="detalle-value url-value">{{ analisis.urlEnlace || analisis.enlaceUrl }}</span>
          </div>

          <!-- Fecha -->
          <div class="detalle-item">
            <span class="detalle-label">ğŸ“… Fecha de AnÃ¡lisis</span>
            <span class="detalle-value">
              {{ analisis.analysisTimestamp || analisis.fecha | date:'dd/MM/yyyy HH:mm:ss' }}
            </span>
          </div>

          <!-- Probabilidad -->
          <div class="detalle-item">
            <span class="detalle-label">ğŸ“Š Probabilidad de Phishing</span>
            <span class="detalle-value confianza-badge" [ngClass]="getConfianzaClass(analisis.probabilityPhishing || analisis.confianza)">
              {{ ((analisis.probabilityPhishing || analisis.confianza) * 100).toFixed(2) }}%
            </span>
          </div>

          <!-- Confianza -->
          <div class="detalle-item">
            <span class="detalle-label">ğŸ¯ Nivel de Confianza</span>
            <span class="detalle-value confidence-badge" [ngClass]="analisis.confidence?.toLowerCase()">
              {{ analisis.confidence || 'N/A' }}
            </span>
          </div>

          <!-- Mensaje -->
          <div class="detalle-item full-width" *ngIf="analisis.message">
            <span class="detalle-label">ğŸ’¬ Mensaje</span>
            <span class="detalle-value">{{ analisis.message }}</span>
          </div>

          <!-- RecomendaciÃ³n -->
          <div class="detalle-item full-width" *ngIf="analisis.recommendation">
            <span class="detalle-label">ğŸ’¡ RecomendaciÃ³n</span>
            <span class="detalle-value recommendation">{{ analisis.recommendation }}</span>
          </div>
        </div>
      </div>

      <!-- GrÃ¡ficos -->
      <div class="graficos-section">
        <h2 class="section-title">ğŸ“Š VisualizaciÃ³n de Datos</h2>

        <div class="graficos-grid">
          <!-- GrÃ¡fico de Riesgo -->
          <div class="grafico-card">
            <div class="grafico-header">
              <h3>Nivel de Riesgo</h3>
              <p class="grafico-descripcion">EvaluaciÃ³n del riesgo detectado</p>
            </div>
            <div class="grafico-container">
              <canvas id="chartRiesgo"></canvas>
            </div>
          </div>

          <!-- GrÃ¡fico de CaracterÃ­sticas -->
          <div class="grafico-card grafico-full">
            <div class="grafico-header">
              <h3>AnÃ¡lisis de CaracterÃ­sticas</h3>
              <p class="grafico-descripcion">Indicadores de seguridad evaluados</p>
            </div>
            <div class="grafico-container">
              <canvas id="chartCaracteristicas"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- CaracterÃ­sticas Detalladas -->
      <div class="caracteristicas-section">
        <h2 class="section-title">ğŸ“‹ CaracterÃ­sticas Detalladas de la URL</h2>

        <div class="caracteristicas-grid">
          <!-- InformaciÃ³n General -->
          <div class="caracteristica-card">
            <h3>â„¹ï¸ InformaciÃ³n General</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud de URL:</span>
                <span class="caracteristica-valor">{{ analisis.urllength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.domain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud del Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.domainLength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud del Path:</span>
                <span class="caracteristica-valor">{{ analisis.pathLength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Protocolo:</span>
                <span class="caracteristica-valor">{{ analisis.protocol }}</span>
              </div>
            </div>
          </div>

          <!-- Seguridad -->
          <div class="caracteristica-card">
            <h3>ğŸ”’ Seguridad</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Tiene HTTPS:</span>
                <span class="caracteristica-valor" [ngClass]="analisis.hasHttps ? 'valor-positivo' : 'valor-negativo'">
                  {{ analisis.hasHttps ? 'âœ… SÃ­' : 'âŒ No' }}
                </span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Tiene Query Params:</span>
                <span class="caracteristica-valor">{{ analisis.hasQuery ? 'âœ… SÃ­' : 'âŒ No' }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">NÃºmero de Subdominios:</span>
                <span class="caracteristica-valor">{{ analisis.numberOfSubdomains }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Puntos en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.dotsInDomain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Guiones en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.hyphensInDomain }}</span>
              </div>
            </div>
          </div>

          <!-- Caracteres y DÃ­gitos -->
          <div class="caracteristica-card">
            <h3>ğŸ”¤ Caracteres y DÃ­gitos</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Caracteres Especiales:</span>
                <span class="caracteristica-valor">{{ analisis.specialCharactersCount }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">DÃ­gitos en URL:</span>
                <span class="caracteristica-valor">{{ analisis.digitsInUrl }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">DÃ­gitos en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.digitsInDomain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">DÃ­gitos Repetidos:</span>
                <span class="caracteristica-valor">{{ analisis.hasRepeatedDigits ? 'âš ï¸ SÃ­' : 'âœ… No' }}</span>
              </div>
            </div>
          </div>

          <!-- Indicadores de Phishing -->
          <div class="caracteristica-card card-alerta">
            <h3>âš ï¸ Indicadores de Phishing</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Palabras Sospechosas:</span>
                <span class="caracteristica-valor" [ngClass]="analisis.suspiciousKeywordsCount && analisis.suspiciousKeywordsCount > 0 ? 'valor-alerta' : 'valor-ok'">
                  {{ analisis.suspiciousKeywordsCount || 0 }}
                </span>
              </div>
              <div class="caracteristica-item full-width" *ngIf="analisis.suspiciousKeywords">
                <span class="caracteristica-label">Lista de Palabras:</span>
                <span class="caracteristica-valor keywords">{{ analisis.suspiciousKeywords }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n TÃ©cnica -->
      <div class="info-tecnica-section">
        <h2 class="section-title">âš™ï¸ InformaciÃ³n TÃ©cnica</h2>
        <div class="info-tecnica-grid">
          <div class="info-item">
            <span class="info-icon">â±ï¸</span>
            <div class="info-content">
              <span class="info-label">Tiempo de Respuesta API</span>
              <span class="info-value">{{ analisis.apiResponseTime }} ms</span>
            </div>
          </div>
          <div class="info-item">
            <span class="info-icon">ğŸ“Œ</span>
            <div class="info-content">
              <span class="info-label">VersiÃ³n de AnÃ¡lisis</span>
              <span class="info-value">{{ analisis.analysisVersion }}</span>
            </div>
          </div>
          <div class="info-item">
            <span class="info-icon">ğŸ·ï¸</span>
            <div class="info-content">
              <span class="info-label">Etiqueta</span>
              <span class="info-value">{{ analisis.label }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
