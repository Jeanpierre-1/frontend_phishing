<div class="analisis-detalle-container">
  <div class="analisis-detalle-content">

    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h1>üìä Reporte Detallado del An√°lisis</h1>
        <p>Caracter√≠sticas completas del an√°lisis de phishing</p>
      </div>
      <div class="header-actions">
        <button class="btn-action btn-volver" (click)="volverAlInicio()">
          ‚Üê Volver al Inicio
        </button>
        <button class="btn-action btn-historial" (click)="verHistorial()">
          üìã Ver Historial
        </button>
        <button class="btn-action btn-exportar-pdf" (click)="exportarPDF()">
          üì• Exportar PDF
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="cargando">
      <div class="spinner"></div>
      <p>Cargando an√°lisis...</p>
    </div>

    <!-- Contenido del An√°lisis -->
    <div class="analisis-content" *ngIf="!cargando && analisis">

      <!-- An√°lisis Detallado -->
      <div class="analisis-card">
        <div class="card-header">
          <h2>üîç Resultado del An√°lisis</h2>
          <span class="badge-resultado" [ngClass]="analisis.isPhishing ? 'badge-peligro' : 'badge-seguro'">
            {{ analisis.isPhishing ? '‚ö†Ô∏è PHISHING DETECTADO' : '‚úÖ SITIO SEGURO' }}
          </span>
        </div>

        <div class="detalle-grid">
          <!-- URL -->
          <div class="detalle-item full-width">
            <span class="detalle-label">üîó URL Analizada</span>
            <span class="detalle-value url-value">{{ analisis.urlEnlace || analisis.enlaceUrl }}</span>
          </div>

          <!-- Fecha -->
          <div class="detalle-item">
            <span class="detalle-label">üìÖ Fecha de An√°lisis</span>
            <span class="detalle-value">
              {{ analisis.analysisTimestamp || analisis.fecha | date:'dd/MM/yyyy HH:mm:ss' }}
            </span>
          </div>

          <!-- Probabilidad -->
          <div class="detalle-item">
            <span class="detalle-label">Probabilidad de Phishing</span>
            <span class="detalle-value confianza-badge" [ngClass]="getConfianzaClass(analisis.probabilityPhishing || analisis.confianza)">
              {{ ((analisis.probabilityPhishing || analisis.confianza) * 100).toFixed(2) }}%
            </span>
          </div>

          <!-- Confianza -->
          <div class="detalle-item">
            <span class="detalle-label">Nivel de Confianza</span>
            <span class="detalle-value confidence-badge" [ngClass]="analisis.confidence?.toLowerCase()">
              {{ analisis.confidence || 'N/A' }}
            </span>
          </div>

          <!-- Mensaje -->
          <div class="detalle-item full-width" *ngIf="analisis.message">
            <span class="detalle-label">üí¨ Mensaje</span>
            <span class="detalle-value">{{ analisis.message }}</span>
          </div>

          <!-- Recomendaci√≥n -->
          <div class="detalle-item full-width" *ngIf="analisis.recommendation">
            <span class="detalle-label">üí° Recomendaci√≥n</span>
            <span class="detalle-value recommendation">{{ analisis.recommendation }}</span>
          </div>
        </div>
      </div>

      <!-- Gr√°ficos -->
      <div class="graficos-section">
        <h2 class="section-title"> Visualizaci√≥n de Datos</h2>

        <div class="graficos-grid">
          <!-- Gr√°fico de Riesgo -->
          <div class="grafico-card">
            <div class="grafico-header">
              <h3>Nivel de Riesgo</h3>
              <p class="grafico-descripcion">Evaluaci√≥n del riesgo detectado</p>
            </div>
            <div class="grafico-container">
              <canvas id="chartRiesgo"></canvas>
            </div>
          </div>

          <!-- Gr√°fico de Caracter√≠sticas -->
          <div class="grafico-card grafico-full">
            <div class="grafico-header">
              <h3>An√°lisis de Caracter√≠sticas</h3>
              <p class="grafico-descripcion">Indicadores de seguridad evaluados</p>
            </div>
            <div class="grafico-container">
              <canvas id="chartCaracteristicas"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Caracter√≠sticas Detalladas -->
      <div class="caracteristicas-section">
        <h2 class="section-title">Caracter√≠sticas Detalladas de la URL</h2>

        <div class="caracteristicas-grid">
          <!-- Informaci√≥n General -->
          <div class="caracteristica-card">
            <h3>Informaci√≥n General</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud de URL:</span>
                <span class="caracteristica-valor">{{ analisis.urlLength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.domain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud del Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.domainLength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Longitud del Path:</span>
                <span class="caracteristica-valor">{{ analisis.pathLength }} caracteres</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Protocolo:</span>
                <span class="caracteristica-valor">{{ analisis.protocol }}</span>
              </div>
            </div>
          </div>

          <!-- Seguridad -->
          <div class="caracteristica-card">
            <h3>Seguridad</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Tiene HTTPS:</span>
                <span class="caracteristica-valor" [ngClass]="analisis.hasHttps ? 'valor-positivo' : 'valor-negativo'">
                  {{ analisis.hasHttps ? '‚úÖ S√≠' : '‚ùå No' }}
                </span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Tiene Query Params:</span>
                <span class="caracteristica-valor">{{ analisis.hasQuery ? '‚úÖ S√≠' : '‚ùå No' }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">N√∫mero de Subdominios:</span>
                <span class="caracteristica-valor">{{ analisis.numberOfSubdomains }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Puntos en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.dotsInDomain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">Guiones en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.hyphensInDomain }}</span>
              </div>
            </div>
          </div>

          <!-- Caracteres y D√≠gitos -->
          <div class="caracteristica-card">
            <h3>Caracteres y D√≠gitos</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Caracteres Especiales:</span>
                <span class="caracteristica-valor">{{ analisis.specialCharactersCount }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">D√≠gitos en URL:</span>
                <span class="caracteristica-valor">{{ analisis.digitsInUrl }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">D√≠gitos en Dominio:</span>
                <span class="caracteristica-valor">{{ analisis.digitsInDomain }}</span>
              </div>
              <div class="caracteristica-item">
                <span class="caracteristica-label">D√≠gitos Repetidos:</span>
                <span class="caracteristica-valor">{{ analisis.hasRepeatedDigits ? '‚ö†Ô∏è S√≠' : '‚úÖ No' }}</span>
              </div>
            </div>
          </div>

          <!-- Indicadores de Phishing -->
          <div class="caracteristica-card card-alerta">
            <h3>Indicadores de Phishing</h3>
            <div class="caracteristica-lista">
              <div class="caracteristica-item">
                <span class="caracteristica-label">Palabras Sospechosas:</span>
                <span class="caracteristica-valor" [ngClass]="analisis.suspiciousKeywordsCount && analisis.suspiciousKeywordsCount > 0 ? 'valor-alerta' : 'valor-ok'">
                  {{ analisis.suspiciousKeywordsCount || 0 }}
                </span>
              </div>
              <div class="caracteristica-item full-width" *ngIf="analisis.suspiciousKeywords">
                <span class="caracteristica-label">Lista de Palabras:</span>
                <span class="caracteristica-valor keywords">{{ analisis.suspiciousKeywords }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
